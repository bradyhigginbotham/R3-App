function PhotosWindow(){var infoWindow=Ti.UI.createWindow({backgroundImage:'images/bg_bigTex.png',title:'Conference Photos'});var closeButton=Ti.UI.createButton({title:'Close'});infoWindow.rightNavButton=closeButton;closeButton.addEventListener('click',function(){infoWindow.close();});var infoText=Ti.UI.createLabel({text:"The R3 Conference photo upload feature allows you to share your experience with other attendees. "+"Choose an image from your media gallery or take one using your device's camera and upload it. "+"Upon approval, your photo will then be added to the image galleries on the conference website for other attendees to view.",color:'#ffffff',top:10,left:10});infoWindow.add(infoText);var uploadProgress,selectPhoto,takePhoto;var Cloud=require('ti.cloud');var self=Ti.UI.createWindow({backgroundImage:'images/bg_bigTex.png',title:'Photo Upload',navBarHidden:false});var infoButton=Ti.UI.createButton({title:"?"});self.rightNavButton=infoButton;infoButton.addEventListener('click',function(){infoWindow.open({modal:true});});var imageView=Ti.UI.createImageView({top:30,left:30,width:260,height:220});self.add(imageView);var photo;var uploadButton=Ti.UI.createButton({title:'Upload',bottom:10,left:40,right:40,height:40});self.add(uploadButton);uploadProgress=Ti.UI.createProgressBar({bottom:uploadButton.bottom+uploadButton.height+10,right:40,left:40,max:1,min:0,value:0,height:40,style:Ti.UI.iPhone.ProgressBarStyle.BAR});self.add(uploadProgress);uploadProgress.show();takePhoto=Ti.UI.createButton({title:'Camera',bottom:uploadProgress.bottom+uploadProgress.height,right:40,width:110,height:40});self.add(takePhoto);selectPhoto=Ti.UI.createButton({title:'Gallery',bottom:uploadProgress.bottom+uploadProgress.height,left:40,width:110,height:40});self.add(selectPhoto);selectPhoto.addEventListener('click',function(evt){Ti.Media.openPhotoGallery({success:function(e){photo=e.media;imageView.image=photo;}});});takePhoto.addEventListener('click',function(evt){Ti.Media.showCamera({success:function(e){photo=e.media;imageView.image=photo;},saveToPhotoGallery:false,allowEditing:true,mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO]});});uploadButton.addEventListener('click',function(){if(!photo){alert('Please provide a photo!');return;};Cloud.onsendstream=function(evt){uploadProgress.value=evt.progress*0.5;};Cloud.ondatastream=function(evt){uploadProgress.value=(evt.progress*0.5)+0.5;};Cloud.Users.login({login:'default',password:'r3AITPconference!'},function(e){if(e.success){var user=e.users[0];Cloud.Photos.create({photo:photo,'photo_sync_sizes[]':'small_240'},function(e){Cloud.onsendstream=Cloud.ondatastream=null;if(e.success){photo=null;collectionID=null;alert('Photo successfully uploaded!');}else{alert('An error occurred during upload.');}});}else{alert('There was an error during upload.');}});});self.addEventListener('close',function(){self.remove(imageView);self.remove(uploadProgress);self.remove(selectPhoto);self.remove(takePhoto);self.remove(uploadButton);imageView=null;uploadProgress.style=null;uploadProgress=null;selectPhoto=null;takePhoto=null;uploadButton=null;self=null;});return self;}
module.exports=PhotosWindow;