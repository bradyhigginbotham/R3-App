function PhotosWindow(){var deviceHeight=Ti.Platform.displayCaps.platformHeight;var deviceWidth=Ti.Platform.displayCaps.platformWidth;var uploadProgress,selectPhoto,takePhoto;var infoWindow=Ti.UI.createWindow({backgroundImage:'images/bg_bigTex.png',title:'Conference Photos'});var closeButton=Ti.UI.createButton({title:'Close'});infoWindow.rightNavButton=closeButton;closeButton.addEventListener('click',function(){infoWindow.close();});var infoText=Ti.UI.createLabel({text:"The R3 Conference photo upload feature allows you to share your experience with other attendees. "+"Choose an image from your media gallery or take one using your device's camera and upload it. "+"Upon approval, your photo will then be added to the image galleries on the conference website for other attendees to view.",color:'#ffffff',top:10,left:10});infoWindow.add(infoText);var Cloud=require('ti.cloud');var self=Ti.UI.createWindow({backgroundImage:'images/bg_bigTex.png',title:'Photo Upload',navBarHidden:false});var infoButton=Ti.UI.createButton({title:"?"});self.rightNavButton=infoButton;infoButton.addEventListener('click',function(){infoWindow.open({modal:true});});var contentView=Ti.UI.createView({layout:'vertical',top:deviceHeight*0.0125,bottom:deviceHeight*0.0125,left:deviceWidth*(40/480),right:deviceWidth*(40/480)});self.add(contentView);var imageView=Ti.UI.createImageView({top:0,left:0,right:0,height:deviceHeight*0.6});contentView.add(imageView);var buttonsView=Ti.UI.createView({top:deviceHeight*0.0375,left:0,right:0,height:deviceHeight*0.0625});contentView.add(buttonsView);selectPhoto=Ti.UI.createButton({title:'Gallery',top:0,left:0,width:'45%',height:deviceHeight*0.0625});buttonsView.add(selectPhoto);takePhoto=Ti.UI.createButton({title:'Camera',top:0,right:0,width:'45%',height:deviceHeight*0.0625});buttonsView.add(takePhoto);uploadProgress=Ti.UI.createProgressBar({top:0,right:0,left:0,max:1,min:0,value:0,height:deviceHeight*0.075,style:Ti.UI.iPhone.ProgressBarStyle.BAR});contentView.add(uploadProgress);uploadProgress.show();var uploadButton=Ti.UI.createButton({title:'Upload',top:deviceHeight*0.0375,left:0,right:0,height:deviceHeight*0.0625});contentView.add(uploadButton);var photo;selectPhoto.addEventListener('click',function(evt){Ti.Media.openPhotoGallery({success:function(e){photo=e.media;imageView.image=photo;}});});takePhoto.addEventListener('click',function(evt){Ti.Media.showCamera({success:function(e){photo=e.media;imageView.image=photo;},saveToPhotoGallery:true,allowEditing:true,mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO]});});uploadButton.addEventListener('click',function(){if(!photo){alert('Please provide a photo!');return;};Cloud.onsendstream=function(evt){uploadProgress.value=evt.progress*0.5;};Cloud.ondatastream=function(evt){uploadProgress.value=(evt.progress*0.5)+0.5;};Cloud.Users.login({login:'default',password:'r3AITPconference!'},function(e){if(e.success){var user=e.users[0];Cloud.Photos.create({photo:photo,'photo_sync_sizes[]':'small_240'},function(e){Cloud.onsendstream=Cloud.ondatastream=null;if(e.success){photo=null;collectionID=null;alert('Photo successfully uploaded!');}else{alert('An error occurred during upload.');}});}else{alert('There was an error during upload.');}});});self.addEventListener('close',function(){self.remove(contentView);imageView=null;uploadProgress=null;selectPhoto=null;takePhoto=null;uploadButton=null;self=null;});return self;}
module.exports=PhotosWindow;