function MapsWindow(navGroup,osname){var delta=0.03;if(osname==="ipad"){var lat=30.206300;var lng=-92.030777;}else{var lat=30.210984;var lng=-92.030777;}
Ti.Geolocation.purpose="Receive User Location";Ti.Geolocation.accuracy=Ti.Geolocation.ACCURACY_BEST;Ti.Geolocation.distanceFilter=10;var self=Ti.UI.createWindow({title:"Conference Map",navBarHidden:false});var homeButton=Ti.UI.createButton({title:'Home'});self.leftNavButton=homeButton;homeButton.addEventListener('click',function(){navGroup.close(self.tabGroup);});if(osname==='android'){var activity=self.activity;activity.onCreateOptionsMenu=function(e){var menu=e.menu;var menuItem=menu.add({title:"Find Me"});menuItem.addEventListener("click",function(e){Ti.Geolocation.getCurrentPosition(function(e){if(e.error){alert('There was an error trying to find your location.');return;}
mapview.setLocation({latitude:e.coords.latitude,longitude:e.coords.longitude,latitudeDelta:delta,longitudeDelta:delta});});mapview.annotations=annotations;});};}else{var refreshButton=Ti.UI.createButton({title:'Refresh'});refreshButton.addEventListener('click',function(e){Ti.Geolocation.getCurrentPosition(function(e){if(e.error){return;}
mapview.setLocation({latitude:e.coords.latitude,longitude:e.coords.longitude,latitudeDelta:delta,longitudeDelta:delta});});mapview.annotations=annotations;});self.rightNavButton=refreshButton;};var db=Ti.Database.install('db/r3.sqlite','r3.sqlite');var annotations=[],pincolor;var annotationsSet=db.execute('SELECT * FROM annotations');while(annotationsSet.isValidRow()){pincolor=annotationsSet.fieldByName('pincolor');annotations.push(Ti.Map.createAnnotation({latitude:annotationsSet.fieldByName('latitude'),longitude:annotationsSet.fieldByName('longitude'),title:annotationsSet.fieldByName('title'),subtitle:annotationsSet.fieldByName('subtitle'),pincolor:annotationsSet.fieldByName('pincolor'),className:'annotation',}))
annotationsSet.next();}
annotationsSet.close();var mapview=Ti.Map.createView({mapType:Ti.Map.STANDARD_TYPE,region:{latitude:lat,longitude:lng,latitudeDelta:delta,longitudeDelta:delta},animate:true,regionFit:true,userLocation:true,annotations:annotations});Ti.Geolocation.getCurrentPosition(function(e){if(e.error){return;}
mapview.setLocation({latitude:lat,longitude:lng,latitudeDelta:delta,longitudeDelta:delta});});self.add(mapview);Ti.App.addEventListener('annotationSelected',function(e){var annoSelected;for(var i=0;i<annotations.length;i++){if(annotations[i].title==e.title)
{annoSelected=annotations[i];};};mapview.selectAnnotation(annoSelected);mapview.setLocation({latitude:annoSelected.latitude,longitude:annoSelected.longitude,latitudeDelta:delta,longitudeDelta:delta});});self.addEventListener('close',function(){self.rightNavButton=null;refreshButton=null;});return self;};module.exports=MapsWindow;